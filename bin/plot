#!/usr/bin/env python

import sys, h5py, os, matplotlib
sys.path.append("lib")
matplotlib.use("Agg")

from multiprocessing import Process
from fdtd.utils import plot, batch, order

hdf5 = h5py.File(sys.argv[1],"r")

pattern = "result/%s-%%.%ds.png" % (hdf5.attrs["name"], order(hdf5["timeline"]))

processes = [Process(target=plot, args=(t.get("ex"), pattern, os.path.basename(t.name))) for t in hdf5["timeline"].values()]

batch(processes, 30) 

hdf5.close()
